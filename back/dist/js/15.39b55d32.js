"use strict";(self["webpackChunkfront"]=self["webpackChunkfront"]||[]).push([[15],{8015:function(e,t,n){n.r(t),n.d(t,{default:function(){return x}});var r=function(){var e=this,t=e._self._c;return t("el-container",{staticClass:"container"},[t("PageDrawer",{ref:"drawer",attrs:{"page-list":e.pageList},on:{onPageChange:e.onPageChange}}),t("el-aside",{attrs:{width:"225px"}},e._l(e.roleList,(function(n){return t("RoleItem",{key:n.id,class:{active:n.id===e.current.id},attrs:{role:n},on:{onRoleChange:e.onRoleChange}})})),1),t("el-main",[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v(e._s(e.currentPage))]),t("el-button",{staticStyle:{float:"right",padding:"3px 0","margin-left":"30px",color:"green"},attrs:{type:"text"},on:{click:e.onSave}},[e._v("保存")]),t("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:function(t){return e.$refs.drawer.show()}}},[e._v("切换页面")]),e.current.tree?t("el-switch",{staticStyle:{float:"right"},model:{value:e.currentRender.show,callback:function(t){e.$set(e.currentRender,"show",t)},expression:"currentRender.show"}}):e._e()],1),e.current.page?t("div",{staticClass:"box"},[e._l(e.current.page,(function(n,r){return["show"!==r?t("div",{key:r,staticClass:"fied"},[t("span",{staticClass:"title"},[e._v(e._s(r))]),e._l(n.config,(function(s,i){return t("div",{key:i,staticClass:"item"},[t("span",[e._v(e._s(i))]),t("div",{staticClass:"f_r"},[n.isButton?[t("el-switch",{model:{value:e.currentRender[r][i].show,callback:function(t){e.$set(e.currentRender[r][i],"show",t)},expression:"currentRender[title][key].show"}},[e._v("显示")])]:[t("el-checkbox",{model:{value:e.currentRender[r][i].show,callback:function(t){e.$set(e.currentRender[r][i],"show",t)},expression:"currentRender[title][key].show"}},[e._v("显示")]),t("el-checkbox",{model:{value:e.currentRender[r][i].write,callback:function(t){e.$set(e.currentRender[r][i],"write",t)},expression:"currentRender[title][key].write"}},[e._v("写")])]],2)])}))],2):e._e()]}))],2):e._e()])],1)],1)},s=[];function i(e){const t=Object.keys(e),n={};return t.forEach((t=>{const r=e[t],s=a(r.config);n[t]={...r},n[t]["config"]=s})),n}function a(e,t={}){return Array.isArray(e)?e.forEach((e=>{a(e,t)})):"object"===typeof e&&null!==e&&(t[e.name]={}),t}function o(e,t){const n={};for(const r in e){const s=e[r];n[r]=c(s,t),n[r].show=t,n[r].write=t}return n}function c(e,t,n={}){if(Array.isArray(e))e.forEach((e=>c(e,t,n)));else if("object"===typeof e&&null!==e)if(e.name)n[e.name]={show:t,write:t};else for(const r in e)n[r]={show:t,write:t},c(e[r].config,t,n[r]);return n}var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"role_item"},[t("div",{staticClass:"wrapper",on:{click:function(t){return e.onRoleChange(e.role)}}},[t("div",[e._v(e._s(e.role.username))]),t("div",{staticClass:"desc"},[e._v(e._s(e.role.desc))])])])},u=[],h={name:"RoleItem",components:{},props:{role:{type:Object,default:()=>{}}},data(){return{}},computed:{},watch:{},created(){},mounted(){},methods:{onRoleChange(e){this.$emit("onRoleChange",e)}}},d=h,g=n(1001),m=(0,g.Z)(d,l,u,!1,null,"4b9284f2",null),f=m.exports,p=function(){var e=this,t=e._self._c;return t("el-drawer",{attrs:{title:"我是标题",visible:e.drawer},on:{"update:visible":function(t){e.drawer=t}}},[e.pageList.length?e._l(e.pageList,(function(n){return t("div",{key:n,staticClass:"container"},[t("span",[e._v(" "+e._s(n))]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.onPageChange(n)}}},[e._v("选择")])],1)})):e._e()],2)},w=[],v={name:"PageDrawer",props:{pageList:{type:Array,default:()=>[]}},components:{},data(){return{drawer:!1}},computed:{},watch:{},created(){},mounted(){},methods:{show(){this.drawer=!0},onPageChange(e){this.drawer=!1,this.$emit("onPageChange",e)}}},_=v,C=(0,g.Z)(_,p,w,!1,null,"284e16ac",null),R=C.exports,y={"首页":{"表单":{config:[{name:"活动名称"},{name:"活动区域"},{name:"活动时间"},{name:"即时配送"},{name:"活动性质"},{name:"活动形式"}]},"操作按钮":{config:[{name:"立即创建"},{name:"取消"}],isButton:!0},"表格":{config:[{name:"立即创建"},{name:"取消"}]}},"其他页面":{"操作按钮":{config:[{name:"立即创建"},{name:"取消"}],isButton:!0},"表格":{config:[{name:"立即创建"},{name:"取消"}]}}},k={name:"PerVue",components:{RoleItem:f,PageDrawer:R},data(){return{roleList:[],pageList:[],current:{id:null,username:null,desc:null,permission:null,page:null,tree:null},currentPage:null,currentRender:null,drawer:!1}},computed:{},watch:{},created(){},mounted(){this.init()},methods:{init(){this.$api.getRoleList().then((e=>{if(0!==e.code&&this.$message.error(e.message||"获取角色列表失败"),this.roleList=e.data,!e.data||this.roleList.length<=0)return this.$message.info("未获取到角色列表");this.initPage(),this.setCurrentRole(e.data[0]),this.setTree()}))},setCurrentRole(e){const{id:t,username:n,desc:r,permission:s}=e;this.current.id=t,this.current.username=n,this.current.desc=r,this.current.permission=s},initPage(){const e=Object.keys(y),t=e[0];this.setPage(t)},setTree(){const e=this.current.permission;"*"===e.trim()?this.current.tree=o(y,!0):this.current.tree=JSON.parse(e);const t=this.currentPage;this.currentRender=this.current.tree[t]},setPage(e){const t=Object.keys(y),n=y[e];if(!n)return this.$message.info("页面不存在～");this.currentPage=e,this.current.page=i(n),this.pageList=t},onPageChange(e){this.setPage(e),this.setTree()},onRoleChange(e){this.initPage(),this.setCurrentRole(e),this.setTree()},onSave(){const{tree:e,id:t}=this.current,n={id:t,permission:JSON.stringify(e)};this.$api.updateRole(n).then((e=>{if(0!==e.code)return this.$message.error(e.message||"保存失败");this.$message.success("保存成功");const t=e.data.permission;this.current.permission=t,this.roleList.find((e=>e.id===this.current.id)).permission=t,this.$store.dispatch("setPermission",t)}))}}},b=k,P=(0,g.Z)(b,r,s,!1,null,"35d92ab6",null),x=P.exports}}]);
//# sourceMappingURL=15.39b55d32.js.map